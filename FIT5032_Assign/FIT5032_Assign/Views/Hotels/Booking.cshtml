@model FIT5032_Assign.Models.Hotel

@{
    ViewBag.Title = "Booking";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .checked {
        color: orange;
    }
</style>
<div style="margin-top:50px"> </div>
<h2>Book a Room</h2>
<div class="row">
    <div id="carouselIndicators" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
            @for (int i = 0; i < Model.Image.Count; i++)
            {
                if (i == 0)
                {
                    <li data-target="#carouselIndicators" data-slide-to="@i" class="active"></li>
                }
                else
                {
                    <li data-target="#carouselIndicators" data-slide-to="@i"></li>
                }
            }
        </ol>
        <div class="carousel-inner">
            @for (int i = 0; i < Model.Image.Count; i++)
            {
                if (i == 0)
                {
                    <div class="carousel-item active">
                        <img src="@Url.Content("~/Uploads/" + Model.Image.ElementAtOrDefault(i).ImagePath)" class="img-responsive center-block">
                    </div>
                }
                else
                {
                    <div class="carousel-item">
                        <img src="@Url.Content("~/Uploads/" + Model.Image.ElementAtOrDefault(i).ImagePath)" class="img-responsive center-block">
                    </div>
                }
            }
        </div>
        <a class="carousel-control-prev" href="#carouselIndicators" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselIndicators" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
</div>
<div>
    <h1 style="margin-top:20px">@Html.DisplayFor(model => model.HotelName)</h1>
    <p>@Html.DisplayFor(model => model.HotelCity), @Html.DisplayFor(model => model.HotelAddress)</p>
    <p>@Html.DisplayFor(model => model.HotelDescription)</p>
    <p>
        Overall Ratting:（@ViewBag.countAll people rated）
        @for (int i = 0; i < Convert.ToInt32(Convert.ToDecimal(Model.HotelRating)); i++)
        {
            <span class="fa fa-star checked"></span>
        }
        @for (int i = 0; i < 5 - Convert.ToDecimal(Model.HotelRating); i++)
        {
            <span class="fa fa-star"></span>
        }
        (@Convert.ToDouble(Model.HotelRating))
    </p>
    
</div>
<hr />
<h4>Rating Distributions</h4>
<canvas id="myChart" width="200" height="100"></canvas>
<script>
    var ctx = document.getElementById('myChart').getContext('2d');
    var starFiveCount = @ViewBag.starFiveCount;
    var starFourCount = @ViewBag.starFourCount;
    var starThreeCount = @ViewBag.starThreeCount;
    var starTwoCount = @ViewBag.starTwoCount;
    var starOneCount = @ViewBag.starOneCount;
    var starZeroCount = @ViewBag.starZeroCount;
    var myChart = new Chart(ctx, {
        type: 'horizontalBar',
        data: {
            labels: ['5 star', '4 stars', '3 stars', '2 stars', '1 star', '0 star'],
            datasets: [{
                label: "hide",
                data: [starFiveCount, starFourCount, starThreeCount, starTwoCount, starOneCount, starZeroCount],
                
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(155, 109, 34, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(155, 109, 34, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
            legend: {
                    display: false
                  }
        }
    });
</script>
<hr/>
<div class="card" style="width: 18rem; margin-top:20px">
    <div class="card-body">
        <h5 class="card-title">Choose check in and out date</h5>
        @using (Html.BeginForm("Booking", "Hotels", FormMethod.Get))
        {
            <div class="form-group input-daterange">
                <label class="control-label">Date from</label>
                <div>
                    <input type="text" class="form-control" id="from" value=@ViewBag.dateFrom name="from" data-date-format="dd/mm/yyyy">
                </div>
                <label class="control-label">Date to</label>
                <div>
                    <input type="text" class="form-control" id="to" value=@ViewBag.dateTo name="to" data-date-format="dd/mm/yyyy">
                </div>
            </div>
            <script type="text/javascript">
                var date = new Date();
                $(function () {
                    $('.input-daterange').datepicker({
                        autoclose: true,
                        format: 'dd/mm/yyyy',
                        startDate: date
                    });
                });
            </script>
            <div class="form-group">
                <div>
                    <input type="submit" value="Search room" class="btn btn-primary" />
                </div>
            </div>
        }
    </div>
</div>


<h4>Rooms from @ViewBag.dateFrom to @ViewBag.dateTo</h4>
<table class="table" style="margin-top: 20px;">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Room type</th>
            <th scope="col">Price</th>
            <th scope="col">Description</th>
            <th scope="col">Aviable rooms</th>
            <th scope="col">Book number</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        <tr>

            @for (int i = 0; i < ViewBag.roomTypeNames.Count; i++)
            {
                <th scope="row">@(i + 1)</th>
                <td>@ViewBag.roomTypeNames[i]</td>
                <td>
                    $@ViewBag.roomPrices[i]/night * @ViewBag.days
                    @if (ViewBag.days > 1)
                    {<p>nights</p>}
                    @if (ViewBag.days == 1)
                    {<p>night</p>}
                </td>
                <td>@ViewBag.descriptions[i]</td>
                <td>@ViewBag.totalRoom[i]</td>
                using (Html.BeginForm("AddBooking", "Bookings", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    <td>
                        <input type="hidden" name="id" value="@ViewBag.roomIds[i]" />
                        <input type="hidden" name="from" value="@ViewBag.dateFrom" />
                        <input type="hidden" name="to" value="@ViewBag.dateTo" />
                        <input type="hidden" name="roomPrice" value="@ViewBag.roomPrices[i]" />
                        <input type="number" name="number" class="form-control" style="max-width: 100px;" min=0 max=@ViewBag.totalRoom[i] value=1 step=1 data-size="lg">
                    </td>
                    <td><input type="submit" value="Book now" class="btn btn-primary" /></td>
                }

            }
        </tr>


    </tbody>

</table>
@if (ViewBag.roomTypeNames.Count == 0)
{
    <p style="text-align: center; font-weight: bold">
        Sorry, no room avaliable currently. Try to input another date range.
    </p>

}